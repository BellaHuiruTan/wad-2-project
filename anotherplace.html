<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css" integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Abril+Fatface|Hind+Siliguri|Pattaya" rel="stylesheet">
    <link href="assets/css/central.css"  rel="stylesheet">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!---------------------- END BASIC CSS (DUN TOUCH HERE) -------------------------->
    <link href="assets/css/home.css"  rel="stylesheet">

    
    <title>Walking-trail</title>
</head>
<body>

<!---------------------END NAV BAR (DUN TOUCH HERE)-------------------->
        <nav class="navbar navbar-expand-lg navbar-light m-1" id="navbar">
            <div class="container-fluid">
                <header id="headerOne">	
                    <div id="divLogo">
                        <h2 id="headlineLogo" style="margin-top: 10px;">EATGREENS</h2>           
                    </div>
                </header>
              <button class="navbar-toggler  " type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto mb-2 mb-lg-0">
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="./home.html">Home</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="./places.html">Walking-trail</a>
                  </li>
                </ul>
              </div>
            </div>
          </nav> 
  <div id= "container">
<!---------------------END NAV BAR (DUN TOUCH HERE)-------------------->



<!------------------------------ CODE HERE ------------------------------->

  <div class = 'img-fluid' id="map-canvas"  style="height:500px ;width:800px;">

</div>
  <div class="card text-dark bg-success mb-3" >
      <div class="card-header">Calories Burn</div>
      <div class="card-body">
        <h5 class="card-title">Distance</h5>
        <p id='location' class="card-text"></p>
  </div>





<!------------------------------ CODE HERE HERE ------------------------------->            
<!---------------------FOOTER (DUN TOUCH HERE)-------------------->          
</div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>   
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js" integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/" crossorigin="anonymous"></script>
   
    <!---------------------FOOTER (DUN TOUCH HERE)-------------------->    
<script>
/////////////////////////////////CODE JS HERE///////////////////////    

var locations = [];
$.ajax({
type: "GET",
dataType: "json",
url: "http://127.0.0.1:5500/data/places.geojson",
//crossDomain: true,
//     beforeSend: function(request) {
//     request.setRequestHeader("apikey", "Hbjt6beOzjpqSGAq9KKKbVBf5YtyzozN");
//   },
//     data: {
//         keyword : "chicken rice",

//     },
success: function(response) {
console.log(response.features)
console.log(response.features[0].geometry.coordinates)
console.log(response.features[0].properties.Name)
console.log(response.features[0].properties.description)
for (var i = 0; i<response.features.length; i++){
var arrays = [response.features[i].properties.Name, response.features[i].properties.description, response.features[i].geometry.coordinates[0],response.features[i].geometry.coordinates[1] ]
locations.push(arrays)

}
},
error: function(xhr) {
console.log(xhr)
}
});
//AIzaSyA2jsy7nXp1UmSBHbyqjBkuCiEVFZPwttQ
console.log(locations)

window.onload = getMyLocation;

var map;
function getMyLocation() {
if (navigator.geolocation) {
navigator.geolocation.getCurrentPosition(displayLocation);
} else {
alert('Oops, no geolocation support');
}
}

//This function is inokved asynchronously by the HTML5 geolocation API.
function displayLocation(position) {
//The latitude and longitude values obtained from HTML 5 API.
var latitude = position.coords.latitude;
var longitude = position.coords.longitude;

//Creating a new object for using latitude and longitude values with Google map.
var latLng = new google.maps.LatLng(latitude, longitude);

showMap(latLng);


createMarker(latLng, latitude, longitude);

//Also setting the latitude and longitude values in another div.
var div = document.getElementById('location');
//div.innerHTML = 'You are at Latitude: ' + latitude + ', Longitude: ' + longitude;
}

function showMap(latLng) {
//Setting up the map options like zoom level, map type.
var mapOptions = {
center: latLng,
zoom: 18,
mapTypeId: google.maps.MapTypeId.ROADMAP
};

//Creating the Map instance and assigning the HTML div element to render it in.
map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
}



//map()




function createMarker(latLng, latitude, longitude, placeResult) {
    

var infowindow = new google.maps.InfoWindow();
var marker, i;
for (i = 0; i < locations.length; i++) {  

marker = new google.maps.Marker({
position: new google.maps.LatLng(locations[i][3], locations[i][2]),
map: map,
animation: google.maps.Animation.DROP,
clickable: true
});
google.maps.event.addListener(marker, 'click', (function(marker, i) {
return function() {
infowindow.setContent(locations[i][0]);

console.log(locations[i][0])                                                    // name of the place
var lat1 = locations[i][3]                                                      // destination lat
var lon2 = locations[i][2]                                                      // destination long

directionService(latitude,longitude, lat1, lon2)

infowindow.open(map, marker);
}
})(marker, i));
}
//console.log(latLng)
var markerOptions = {
position: latLng,
map: map,
animation: google.maps.Animation.DROP,
clickable: true
}
//Setting up the marker object to mark the location on the map canvas.
var marker = new google.maps.Marker(markerOptions);

if (placeResult) {
var content = placeResult.name+'<br/>'+placeResult.vicinity+'<br/>'+placeResult.types;
addInfoWindow(marker, latLng, content);
}
else {
var content = 'You are here: ' + latLng.lat() + ', ' + latLng.lng();
addInfoWindow(marker, latLng, content);
}

}

function addInfoWindow(marker, latLng, content) {
var infoWindowOptions = {
content: content,
position: latLng
};

var infoWindow = new google.maps.InfoWindow(infoWindowOptions);

google.maps.event.addListener(marker, 'click', function() {
infoWindow.open(map);
});
}

// Display path from location A to B
function directionService(latitude,longitude, lat1, lon2){

    let directionsService = new google.maps.DirectionsService();
    let directionsRenderer = new google.maps.DirectionsRenderer();
    directionsRenderer.setMap(map); // Existing map object displays directions
    // Create route from existing points used for markers
    const route = {
        
        origin: {lat: latitude, lng: longitude},
        destination: {lat: lat1, lng: lon2},
        travelMode: 'WALKING'
    }

    directionsService.route(route,
        function(response, status) { // anonymous function to capture directions
        if (status !== 'OK') {
            window.alert('Directions request failed due to ' + status);
            return;
        } else {
            directionsRenderer.setDirections(response); // Add route to the map
            console.log(response)
            var directionsData = response.routes[0].legs[0]; // Get data about the mapped route
            if (!directionsData) {
            window.alert('Directions request failed');
            return;
            }
            else {
            document.getElementById('location').innerHTML += "<br/> Walking distance is " + directionsData.distance.text + " (" + directionsData.duration.text + ").";
            
            //Nutrition API get distance travelled to calculate calorie burned
            var distance = directionsData.distance.text
            nutritionCalorie(distance)
            }
      }
    });
}

function nutritionCalorie(distance) {
  
    var myHeaders = new Headers();
    myHeaders.append("x-app-id", "931cc72d");
    myHeaders.append("x-app-key", "7fc5d91a151ecaed81346157d6f12d05");
    myHeaders.append("Content-Type", "application/json");
    
    var queryDistance = "walk " + distance        // exercise in what mode? Walk / Run etc.
    console.log(queryDistance)
    var raw = JSON.stringify({
    "query": queryDistance,
    "gender": "female",
    "weight_kg": 72.5,
    "height_cm": 167.64,
    "age": 30
    });

    var requestOptions = {
    method: 'POST',
    headers: myHeaders,
    body: raw,
    redirect: 'follow'
    };

    fetch("https://trackapi.nutritionix.com/v2/natural/exercise?e433c1b7=779f40fa08272ff7f88c07da649dc33b", requestOptions)
    .then(response => response.text())
    .then(result => {
    var data = JSON.parse(result)
    //console.log(data.exercises[0])                      // Datas 
    var calorie = data.exercises[0]['nf_calories']      // calories burned
    var duration = data.exercises[0]['duration_min']    // duration
    var calorieResult = `<br/>Congratulation! You have burned ` + calorie + ` calories in ` + duration +' minutes'
    console.log(calorieResult)
    document.getElementById('location').innerHTML += calorieResult

    })
    .catch(error => console.log('error', error));
}



/////////////////////////////////END CODE JS HERE///////////////////////
</script>

  </body>


</html>



<!-- <script type='text/javascript'
src='https://maps.googleapis.com/maps/api/js?sensor=true&libraries=places,weather'></script> -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>   
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js" integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/" crossorigin="anonymous"></script>
<!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA2jsy7nXp1UmSBHbyqjBkuCiEVFZPwttQ&callback=initialize_map">
</script> -->
<script async
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA2jsy7nXp1UmSBHbyqjBkuCiEVFZPwttQ&callback=initMap">
</script> 
</body>


</html>
